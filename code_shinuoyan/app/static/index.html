<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <title>BBP Prototype (Route B) - MAP</title>

  <!-- Leaflet (地图) CSS -->
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"/>

  <style>
    body { font-family: Arial, sans-serif; margin: 0; }
    .layout { display: grid; grid-template-columns: 380px 1fr; height: 100vh; }
    .panel { padding: 16px; border-right: 1px solid #ddd; overflow: auto; }
    .row { margin: 10px 0; }
    input, select, button { padding: 6px; margin-right: 8px; width: 100%; box-sizing: border-box; }
    button { width: auto; }
    #map { height: 100%; width: 100%; }
    pre { background: #f5f5f5; padding: 10px; overflow: auto; }
    h1 { margin-top: 0; }
    .two { display: grid; grid-template-columns: 1fr 1fr; gap: 8px; }
    .small { font-size: 12px; color:#666; }
  </style>
</head>

<body>
  <div class="layout">
    <!-- 左侧面板 -->
    <div class="panel">
      <h1>BBP Prototype (Route B)</h1>

      <h2>Users</h2>
      <div class="row">
        <input id="u_name" placeholder="username e.g. alice" />
        <button id="btn_create_user">Create / Get User</button>
      </div>

      <h2>Segments</h2>
      <div class="row">
        <div class="two">
          <input id="userId" placeholder="user_id (数字)" />
          <select id="status">
            <option value="optimal">optimal</option>
            <option value="suboptimal">suboptimal</option>
          </select>
        </div>
      </div>
      <div class="row">
        <input id="obstacle" placeholder="obstacle (可空)" />
      </div>
      <div class="row">
        <button id="btn_create_segment">Create Segment</button>
        <button id="btn_load_segments">Load Segments</button>
      </div>

      <div class="row">
        <select id="segmentSelect" style="width:100%"></select>
        <div class="small">先 Load Segments 再选一个 segment</div>
      </div>

      <h2>Reports</h2>
      <div class="row">
        <input id="reportNote" placeholder="report note (可空)" />
      </div>
      <div class="row">
        <button id="btn_create_report">Create Report</button>
        <button id="btn_load_reports">Load Reports</button>
      </div>

      <div class="row">
        <input id="confirmReportId" placeholder="confirm report_id (数字)" />
        <button id="btn_confirm_report">Confirm Report</button>
      </div>

      <h2>Aggregate</h2>
      <div class="row">
        <button id="btn_aggregate">Aggregate</button>
      </div>

      <h2>Route Query (Trip)</h2>
      <div class="row two">
        <input id="tripUserId" placeholder="user_id (数字)" />
        <button id="btn_trip">Compute Route</button>
      </div>
      <div class="row two">
        <input id="fromLat" placeholder="from_lat" />
        <input id="fromLon" placeholder="from_lon" />
      </div>
      <div class="row two">
        <input id="toLat" placeholder="to_lat" />
        <input id="toLon" placeholder="to_lon" />
      </div>

      <div class="row">
        <button id="btn_clear">Clear Output</button>
      </div>

      <h2>Output</h2>
      <pre id="out">Ready.</pre>
    </div>

    <!-- 右侧地图 -->
    <div id="map"></div>
  </div>

  <!-- ✅ 关键：Leaflet JS 必须在 app.js 之前加载 -->
  <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>

  <script>
    // 初始化地图（全局给 app.js 用）
    const map = L.map('map').setView([1.3521, 103.8198], 12);
    L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
      maxZoom: 19,
      attribution: '© OpenStreetMap'
    }).addTo(map);
    window.__map = map;
  </script>

  <!-- ✅ 加版本号防缓存（每次改 JS 改 v=...） -->
  <script src="/static/app.js?v=2"></script>
</body>
</html>














